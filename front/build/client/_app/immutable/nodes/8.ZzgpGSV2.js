import{s as P,a as A,n as b,o as G}from"../chunks/scheduler.BfJEPAwo.js";import{S as H,i as O,e as _,s as k,v as q,b as C,g as w,d as x,f as z,h as $,n as I,a as j}from"../chunks/index.CbF2QnM9.js";import{b as T,l as E,m as S,s as y,a as L,c as M}from"../chunks/transform.o5gYejY9.js";function V(g){let a,o="",h,s,e,v='<div class="graph svelte-1hojb56"><div id="graph"></div></div> <div class="message svelte-1hojb56"><span class="svelte-1hojb56">!</span> Pinche en un país para mostrar más información</div> <div class="graph svelte-1hojb56"><div id="countryGraph"></div></div>';return{c(){a=_("script"),a.innerHTML=o,s=k(),e=_("div"),e.innerHTML=v,this.h()},l(l){const p=q("svelte-1eq4axz",document.head);a=C(p,"SCRIPT",{src:!0,"data-svelte-h":!0}),w(a)!=="svelte-1nxlm2a"&&(a.innerHTML=o),p.forEach(x),s=z(l),e=C(l,"DIV",{class:!0,"data-svelte-h":!0}),w(e)!=="svelte-zrrd8b"&&(e.innerHTML=v),this.h()},h(){A(a.src,h="https://d3js.org/d3.v7.min.js")||$(a,"src",h),$(e,"class","container svelte-1hojb56")},m(l,p){I(document.head,a),j(l,s,p),j(l,e,p)},p:b,i:b,o:b,d(l){l&&(x(s),x(e)),x(a)}}}function R(g){const a=g.reduce((s,e)=>(s[e.geo]||(s[e.geo]=0),s[e.geo]+=e.obs_value,s),{}),o=Object.entries(a).map(([s,e])=>({country:s,totalSales:e}));return o.sort((s,e)=>e.totalSales-s.totalSales),{categories:o.map(s=>s.country),series:o.map(s=>s.totalSales)}}function B(g){g.sort((o,h)=>o.year-h.year);const a={categories:[],series:[]};return g.forEach(o=>{a.categories.push(o.year),a.series.push(o.obs_value)}),a}function N(g){let a="/api/v2/vehicles-stock",o="";async function h(){try{let t=await fetch(`${a}?limit=10000`,{method:"GET",headers:{"Cache-Control":"no-cache",Pragma:"no-cache"}});if(t.ok)return await t.json();t.status==404?o="No hay datos en la base de datos":o=`Error ${t.status}: ${t.statusText}`}catch(t){o=t}}async function s(){let t=await h();const r=R(t);v(r),e("España",t)}function e(t,r){const n=r.filter(d=>d.geo===t),c=B(n);l(c,t)}async function v(t){const r={top:20,right:30,bottom:30,left:70},n=800-r.left-r.right,c=400-r.top-r.bottom,d=T().domain(t.categories).range([0,n]).padding(.1),f=E().domain([0,S(t.series)]).nice().range([c,0]),m=y("#graph").append("svg").attr("width",n+r.left+r.right).attr("height",c+r.top+r.bottom).append("g").attr("transform",`translate(${r.left},${r.top})`);m.selectAll(".bar").data(t.categories).join("rect").attr("class","bar").attr("x",i=>d(i)).attr("y",i=>f(t.series[t.categories.indexOf(i)])).attr("width",d.bandwidth()).attr("height",i=>c-f(t.series[t.categories.indexOf(i)])).attr("fill","#3E92CC").on("click",function(i,u){e(u,p)}),m.append("g").attr("transform",`translate(0,${c})`).call(L(d)),m.append("g").call(M(f))}async function l(t,r){const n={top:50,right:0,bottom:30,left:70},c=800-n.left-n.right,d=400-n.top-n.bottom,f=T().domain(t.categories).range([0,c]).padding(.1),m=E().domain([0,S(t.series)]).nice().range([d,0]);y("#countryGraph").selectAll("*").remove();const i=y("#countryGraph").append("svg").attr("width",c+n.left+n.right).attr("height",d+n.top+n.bottom).append("g").attr("transform",`translate(${n.left},${n.top})`);i.selectAll(".dot").data(t.categories).join("circle").attr("class","dot").attr("cx",u=>f(u)).attr("cy",u=>m(t.series[t.categories.indexOf(u)])).attr("r",5).attr("fill","#3E92CC"),i.append("g").attr("transform",`translate(0,${d})`).call(L(f)),i.append("g").call(M(m)),i.append("text").attr("x",c/2).attr("y",0-n.top/2).attr("text-anchor","middle").style("font-size","16px").text(`Ventas de vehículos en ${r}`)}let p;return G(async()=>{p=await h(),s()}),[]}class Q extends H{constructor(a){super(),O(this,a,N,V,P,{})}}export{Q as component};
